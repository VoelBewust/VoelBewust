<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>box breathing</title>
<style>
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: sans-serif;
    background-color: #7abf3f;
    height: 100vh;
    justify-content: center;
  }

  .container {
    position: relative;
    width: 300px;
    height: 300px;
    border: 2px solid white;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 20px;
  }

  .label-top, .label-bottom, .label-left, .label-right {
    position: absolute;
    color: white;
    font-weight: bold;
  }

  .label-top { top: -25px; left: 50%; transform: translateX(-50%); }
  .label-bottom { bottom: -25px; left: 50%; transform: translateX(-50%); }
  .label-left { left: -50px; top: 50%; transform: translateY(-50%); }
  .label-right { right: -50px; top: 50%; transform: translateY(-50%); }

  .line {
    position: absolute;
    border: 4px solid white;
    width: 0;
    height: 0;
    box-sizing: border-box;
  }

  .center-timer {
    position: absolute;
    color: white;
    font-size: 2em;
    font-weight: bold;
  }

  .controls {
    position: fixed;
    top: 30px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .controls label {
    color: white;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .controls label span {
    display: inline-block;
    width: 180px;
    text-align: right;
  }

  .controls input[type="number"] {
    width: 80px;
    padding: 4px 8px;
    font-size: 14px;
  }

  .controls button {
    margin-top: 10px;
    padding: 8px 16px;
    font-size: 14px;
    cursor: pointer;
    background-color: white;
    border: none;
    border-radius: 4px;
    font-weight: bold;
  }

  .controls button:hover {
    background-color: #f0f0f0;
  }

  .hidden {
    display: none !important;
  }

  #stopBtn {
    position: fixed;
    top: 30px;
    left: 50%;
    transform: translateX(-50%);
    padding: 8px 16px;
    font-size: 14px;
    cursor: pointer;
    background-color: white;
    border: none;
    border-radius: 4px;
    font-weight: bold;
  }

  #stopBtn:hover {
    background-color: #f0f0f0;
  }
</style>
</head>
<body>

<div class="controls">
  <label>
    <span>Snelheid (sec per zijde):</span>
    <input type="number" id="speedInput" value="4" min="1">
  </label>
  <label>
    <span>Timer (minuten):</span>
    <input type="number" id="timerInput" value="5" min="1">
  </label>
  <button id="startBtn">Start</button>
</div>

<button id="stopBtn" class="hidden">Stop</button>

<div class="container" id="container">
  <div class="label-top">IN</div>
  <div class="label-bottom">UIT</div>
  <div class="label-left">VAST</div>
  <div class="label-right">VAST</div>

  <div class="line" id="line"></div>
  <div class="center-timer" id="centerTimer">05:00</div>
</div>

<script>
const line = document.getElementById('line');
const centerTimer = document.getElementById('centerTimer');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const container = document.getElementById('container');
const controls = document.querySelector('.controls');
const speedInput = document.getElementById('speedInput');
const timerInput = document.getElementById('timerInput');

let animationId;
let totalSeconds;
let remainingSeconds;
let lastSide = -1;
let endSoundPlayed = false;

// Initiële staat: verberg stop knop
line.style.display = "none";
stopBtn.classList.add('hidden');

// Creëer een zacht geluid met Web Audio API
const audioContext = new (window.AudioContext || window.webkitAudioContext)();

function playTransitionSound() {
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();

  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);

  // Zachte toon (A4 = 440Hz)
  oscillator.frequency.value = 440;
  oscillator.type = 'sine';

  // Zachte volume met fade out
  gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
  gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);

  oscillator.start(audioContext.currentTime);
  oscillator.stop(audioContext.currentTime + 0.2);
}

function playEndSound() {
  // Speel een dubbele ping bij einde
  const oscillator1 = audioContext.createOscillator();
  const oscillator2 = audioContext.createOscillator();
  const gainNode1 = audioContext.createGain();
  const gainNode2 = audioContext.createGain();

  oscillator1.connect(gainNode1);
  oscillator2.connect(gainNode2);
  gainNode1.connect(audioContext.destination);
  gainNode2.connect(audioContext.destination);

  // Eerste ping (hoger, 880Hz = A5)
  oscillator1.frequency.value = 880;
  oscillator1.type = 'sine';
  gainNode1.gain.setValueAtTime(0.15, audioContext.currentTime);
  gainNode1.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);

  // Tweede ping (lager, 660Hz = E5) - iets later
  oscillator2.frequency.value = 660;
  oscillator2.type = 'sine';
  gainNode2.gain.setValueAtTime(0, audioContext.currentTime);
  gainNode2.gain.setValueAtTime(0.15, audioContext.currentTime + 0.15);
  gainNode2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

  oscillator1.start(audioContext.currentTime);
  oscillator1.stop(audioContext.currentTime + 0.3);
  oscillator2.start(audioContext.currentTime + 0.15);
  oscillator2.stop(audioContext.currentTime + 0.5);
}

function startAnimation() {
  cancelAnimationFrame(animationId);

  // Verberg controls, toon stop knop
  controls.classList.add('hidden');
  stopBtn.classList.remove('hidden');

  line.style.display = "";
  const speed = parseFloat(speedInput.value); // seconden per zijde
  totalSeconds = parseInt(timerInput.value) * 60;
  remainingSeconds = totalSeconds;
  endSoundPlayed = false;
  lastSide = -1;

  centerTimer.textContent = formatTime(remainingSeconds);

  const containerSize = 300;
  const borderWidth = 4;
  const sideLength = containerSize;
  const totalLength = sideLength * 4;

  let startTime = null;

  function animate(timestamp) {
    if (!startTime) startTime = timestamp;
    const elapsed = (timestamp - startTime) / 1000; // in sec

    const speedPerSide = speed;
    const totalAnimationLength = speedPerSide * 4; // 4 kanten
    let progress = (elapsed % totalAnimationLength) / totalAnimationLength;

    // Bepaal huidige zijde voor geluid
    let currentSide;
    if (progress < 0.25) currentSide = 0;
    else if (progress < 0.5) currentSide = 1;
    else if (progress < 0.75) currentSide = 2;
    else currentSide = 3;

    // Speel geluid bij overgang naar nieuwe zijde
    if (currentSide !== lastSide && lastSide !== -1) {
      playTransitionSound();
    }
    lastSide = currentSide;

    let x = 0, y = 0, w = 0, h = 0;

if (progress < 0.25) { // top (links → rechts)
  w = sideLength * (progress / 0.25);
  h = borderWidth;
  line.style.top = '0px';
  line.style.left = '0px';
  line.style.width = w + 'px';
  line.style.height = h + 'px';

} else if (progress < 0.5) { // right (boven → onder)
  progress = (progress - 0.25)/0.25;
  w = borderWidth;
  h = sideLength * progress;
  line.style.top = '0px';
  line.style.left = (sideLength - borderWidth) + 'px';
  line.style.width = w + 'px';
  line.style.height = h + 'px';

} else if (progress < 0.75) {
  // bottom (rechts → links)  << AANGEPAST
  progress = (progress - 0.5)/0.25;
  w = sideLength * progress;
  h = borderWidth;
  line.style.top = (sideLength - borderWidth) + 'px';

  // start van rechts → links
  line.style.left = (sideLength - w) + 'px';

  line.style.width = w + 'px';
  line.style.height = h + 'px';

} else {
  // left (onder → boven) << AANGEPAST
  progress = (progress - 0.75)/0.25;
  w = borderWidth;
  h = sideLength * progress;

  // start onder → boven
  line.style.top = (sideLength - h) + 'px';

  line.style.left = '0px';
  line.style.width = w + 'px';
  line.style.height = h + 'px';
}

    // Timer aftellen
    const elapsedSeconds = Math.floor(elapsed);
    remainingSeconds = totalSeconds - elapsedSeconds;
    if (remainingSeconds < 0) remainingSeconds = 0;
    centerTimer.textContent = formatTime(remainingSeconds);

    // Speel eindgeluid en stop als tijd op is
    if (remainingSeconds === 0 && !endSoundPlayed) {
      playEndSound();
      endSoundPlayed = true;
      stopAnimation();
      return;
    }

    animationId = requestAnimationFrame(animate);
  }

  requestAnimationFrame(animate);
}

function stopAnimation() {
  cancelAnimationFrame(animationId);
  line.style.display = "none";
  lastSide = -1;
  endSoundPlayed = false;
  centerTimer.textContent = formatTime(parseInt(timerInput.value) * 60);

  // Verberg stop knop, toon controls
  stopBtn.classList.add('hidden');
  controls.classList.remove('hidden');
}

function formatTime(seconds) {
  const m = Math.floor(seconds / 60).toString().padStart(2,'0');
  const s = (seconds % 60).toString().padStart(2,'0');
  return `${m}:${s}`;
}

startBtn.addEventListener('click', startAnimation);
stopBtn.addEventListener('click', stopAnimation);

let wakeLock = null;

async function requestWakeLock() {
  try {
    wakeLock = await navigator.wakeLock.request('screen');
    wakeLock.addEventListener('release', () => {
      console.log('Screen Wake Lock released');
    });
    console.log('Screen Wake Lock active');
  } catch (err) {
    console.error(`${err.name}, ${err.message}`);
  }
}

// Call this when the page loads
requestWakeLock();

</script>

</body>
</html>

