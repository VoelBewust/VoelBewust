<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>box breathing</title>
<style>
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: sans-serif;
    background-color: #7abf3f;
    height: 100vh;
    justify-content: center;
  }

  .container {
    position: relative;
    width: 300px;
    height: 300px;
    border: 2px solid white;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 20px;
  }

  .label-top, .label-bottom, .label-left, .label-right {
    position: absolute;
    color: white;
    font-weight: bold;
  }

  .label-top { top: -25px; left: 50%; transform: translateX(-50%); }
  .label-bottom { bottom: -25px; left: 50%; transform: translateX(-50%); }
  .label-left { left: -50px; top: 50%; transform: translateY(-50%); }
  .label-right { right: -50px; top: 50%; transform: translateY(-50%); }

  .line {
    position: absolute;
    border: 4px solid white;
    width: 0;
    height: 0;
    box-sizing: border-box;
  }

  .center-timer {
    position: absolute;
    color: white;
    font-size: 2em;
    font-weight: bold;
  }

  .controls {
    position: fixed;
    top: 30px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .controls label {
    color: white;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .controls label span {
    display: inline-block;
    width: 150px;
    text-align: right;
  }

  .controls input[type="number"] {
    width: 80px;
    padding: 4px 8px;
    font-size: 14px;
  }

  .controls button {
    margin-top: 10px;
    padding: 8px 16px;
    font-size: 14px;
    cursor: pointer;
    background-color: white;
    border: none;
    border-radius: 4px;
    font-weight: bold;
  }

  .hidden {
    display: none !important;
  }

  #stopBtn {
    position: fixed;
    top: 30px;
    left: 50%;
    transform: translateX(-50%);
    padding: 8px 16px;
    font-size: 14px;
    cursor: pointer;
    background-color: white;
    border: none;
    border-radius: 4px;
    font-weight: bold;
    z-index: 1000;
    width: 260px;
  }
</style>
</head>
<body>

<div class="controls">
  <label>
    <span>IN (seconden):</span>
    <input type="number" id="topInput" step="0.1" value="2.7" min="0.1" max="30">
  </label>
  <label>
    <span>VAST rechts (seconden):</span>
    <input type="number" id="rightInput" step="0.1" value="1.3" min="0.1" max="30">
  </label>
  <label>
    <span>UIT (seconden):</span>
    <input type="number" id="bottomInput" step="0.1" value="4.7" min="0.1" max="30">
  </label>
  <label>
    <span>VAST links (seconden):</span>
    <input type="number" id="leftInput" step="0.1" value="1.3" min="0.1" max="30">
  </label>
  <label>
    <span>Timer (minuten):</span>
    <input type="number" id="timerInput" value="6" min="1">
  </label>
  <button id="startBtn">Start</button>
</div>

<button id="stopBtn" class="hidden">Stop</button>

<div class="container" id="container">
  <div class="label-top">IN</div>
  <div class="label-bottom">UIT</div>
  <div class="label-left">VAST</div>
  <div class="label-right">VAST</div>

  <div class="line" id="line"></div>
  <div class="center-timer" id="centerTimer">06:00</div>
</div>

<script>
const line = document.getElementById('line');
const centerTimer = document.getElementById('centerTimer');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const container = document.getElementById('container');
const controls = document.querySelector('.controls');
const topInput = document.getElementById('topInput');
const rightInput = document.getElementById('rightInput');
const bottomInput = document.getElementById('bottomInput');
const leftInput = document.getElementById('leftInput');
const timerInput = document.getElementById('timerInput');

let animationId;
let totalSeconds;
let remainingSeconds;
let lastSide = -1;
let endSoundPlayed = false;

// Initiële staat: verberg container en stop knop
line.style.display = "none";
container.classList.add('hidden');
stopBtn.classList.add('hidden');

// Creëer een zacht geluid met Web Audio API
const audioContext = new (window.AudioContext || window.webkitAudioContext)();

function playTransitionSound() {
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();

  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);

  // Zachte toon (A4 = 440Hz)
  oscillator.frequency.value = 440;
  oscillator.type = 'sine';

  // Zachte volume met fade out
  gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
  gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);

  oscillator.start(audioContext.currentTime);
  oscillator.stop(audioContext.currentTime + 0.2);
}

function playEndSound() {
  // Speel een dubbele ping bij einde
  const oscillator1 = audioContext.createOscillator();
  const oscillator2 = audioContext.createOscillator();
  const gainNode1 = audioContext.createGain();
  const gainNode2 = audioContext.createGain();

  oscillator1.connect(gainNode1);
  oscillator2.connect(gainNode2);
  gainNode1.connect(audioContext.destination);
  gainNode2.connect(audioContext.destination);

  // Eerste ping (hoger, 880Hz = A5)
  oscillator1.frequency.value = 880;
  oscillator1.type = 'sine';
  gainNode1.gain.setValueAtTime(0.15, audioContext.currentTime);
  gainNode1.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);

  // Tweede ping (lager, 660Hz = E5) - iets later
  oscillator2.frequency.value = 660;
  oscillator2.type = 'sine';
  gainNode2.gain.setValueAtTime(0, audioContext.currentTime);
  gainNode2.gain.setValueAtTime(0.15, audioContext.currentTime + 0.15);
  gainNode2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

  oscillator1.start(audioContext.currentTime);
  oscillator1.stop(audioContext.currentTime + 0.3);
  oscillator2.start(audioContext.currentTime + 0.15);
  oscillator2.stop(audioContext.currentTime + 0.5);
}

function startAnimation() {
  cancelAnimationFrame(animationId);

  // Verberg controls en start knop, toon container en stop knop
  controls.classList.add('hidden');
  container.classList.remove('hidden');
  stopBtn.classList.remove('hidden');

  line.style.display = "";

  // Haal individuele tijden op
  const topTime = parseFloat(topInput.value);
  const rightTime = parseFloat(rightInput.value);
  const bottomTime = parseFloat(bottomInput.value);
  const leftTime = parseFloat(leftInput.value);

  totalSeconds = parseInt(timerInput.value) * 60;
  remainingSeconds = totalSeconds;
  endSoundPlayed = false;

  centerTimer.textContent = formatTime(remainingSeconds);

  const containerSize = 300;
  const borderWidth = 4;
  const sideLength = containerSize;

  let startTime = null;
  lastSide = -1;

  function animate(timestamp) {
    if (!startTime) startTime = timestamp;
    const elapsed = (timestamp - startTime) / 1000; // in sec

    const totalAnimationLength = topTime + rightTime + bottomTime + leftTime;
    const cycleTime = elapsed % totalAnimationLength;

    // Bepaal welke zijde en progress binnen die zijde
    let currentSide;
    let sideProgress;

    if (cycleTime < topTime) {
      currentSide = 0; // top
      sideProgress = cycleTime / topTime;
    } else if (cycleTime < topTime + rightTime) {
      currentSide = 1; // right
      sideProgress = (cycleTime - topTime) / rightTime;
    } else if (cycleTime < topTime + rightTime + bottomTime) {
      currentSide = 2; // bottom
      sideProgress = (cycleTime - topTime - rightTime) / bottomTime;
    } else {
      currentSide = 3; // left
      sideProgress = (cycleTime - topTime - rightTime - bottomTime) / leftTime;
    }

    // Speel geluid bij overgang naar nieuwe zijde
    if (currentSide !== lastSide && lastSide !== -1) {
      playTransitionSound();
    }
    lastSide = currentSide;

    let w = 0, h = 0;

    if (currentSide === 0) { // top (links → rechts)
      w = sideLength * sideProgress;
      h = borderWidth;
      line.style.top = '0px';
      line.style.left = '0px';
      line.style.width = w + 'px';
      line.style.height = h + 'px';

    } else if (currentSide === 1) { // right (boven → onder)
      w = borderWidth;
      h = sideLength * sideProgress;
      line.style.top = '0px';
      line.style.left = (sideLength - borderWidth) + 'px';
      line.style.width = w + 'px';
      line.style.height = h + 'px';

    } else if (currentSide === 2) { // bottom (rechts → links)
      w = sideLength * sideProgress;
      h = borderWidth;
      line.style.top = (sideLength - borderWidth) + 'px';
      line.style.left = (sideLength - w) + 'px';
      line.style.width = w + 'px';
      line.style.height = h + 'px';

    } else { // left (onder → boven)
      w = borderWidth;
      h = sideLength * sideProgress;
      line.style.top = (sideLength - h) + 'px';
      line.style.left = '0px';
      line.style.width = w + 'px';
      line.style.height = h + 'px';
    }

    // Timer aftellen
    const elapsedSeconds = Math.floor(elapsed);
    remainingSeconds = totalSeconds - elapsedSeconds;
    if (remainingSeconds < 0) remainingSeconds = 0;
    centerTimer.textContent = formatTime(remainingSeconds);

    // Speel eindgeluid en stop als tijd op is
    if (remainingSeconds === 0 && !endSoundPlayed) {
      playEndSound();
      endSoundPlayed = true;
      stopAnimation();
      return;
    }

    animationId = requestAnimationFrame(animate);
  }

  requestAnimationFrame(animate);
}

function stopAnimation() {
  cancelAnimationFrame(animationId);
  line.style.display = "none";
  lastSide = -1;
  endSoundPlayed = false;
  centerTimer.textContent = formatTime(parseInt(timerInput.value) * 60);

  // Verberg container en stop knop, toon controls en start knop
  container.classList.add('hidden');
  stopBtn.classList.add('hidden');
  controls.classList.remove('hidden');
}

function formatTime(seconds) {
  const m = Math.floor(seconds / 60).toString().padStart(2,'0');
  const s = (seconds % 60).toString().padStart(2,'0');
  return `${m}:${s}`;
}

startBtn.addEventListener('click', startAnimation);
stopBtn.addEventListener('click', stopAnimation);

let wakeLock = null;

async function requestWakeLock() {
    try {
        wakeLock = await navigator.wakeLock.request('screen');
        wakeLock.addEventListener('release', () => {
            console.log('Screen Wake Lock released');
        });
        console.log('Screen Wake Lock active');
    } catch (err) {
        console.error(`${err.name}, ${err.message}`);
    }
}

// Call this when the page loads
requestWakeLock();

</script>

</body>
</html>

